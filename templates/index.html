<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArborNote - Tree Detection Interface</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="{{ url_for('static', filename='arbornote-logo-white.png') }}" alt="ArborNote" class="logo-image">
                </div>
            </div>
            
            <div class="sidebar-content">
                <!-- Project Section -->
                <div class="section">
                    <div class="section-title">
                        <i class="fas fa-project-diagram"></i>
                        Project Information
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Project Name</label>
                        <input type="text" class="form-input" id="projectName" placeholder="Enter project name">
                    </div>
                </div>
                
                <!-- Location Section -->
                <div class="section">
                    <div class="section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Location Setup
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Search Address</label>
                        <div class="map-search">
                            <input type="text" class="form-input" id="address-search" placeholder="Enter address or location">
                            <div id="search-results" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <button class="btn btn-outline btn-full" id="search-button">
                        <i class="fas fa-search"></i>
                        Find Location
                    </button>
                    
                    <div class="form-group mt-2">
                        <label class="form-label">Upload KML File</label>
                        <input type="file" class="form-input" id="kmlUpload" accept=".kml,.kmz">
                    </div>
                </div>
                
                <!-- Analysis Settings -->
                <div class="section">
                    <div class="section-title">
                        <i class="fas fa-cog"></i>
                        Analysis Settings
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">AI Model</label>
                        <select class="form-select" id="modelSelect">
                            <option value="">Loading models...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Imagery Date</label>
                        <select class="form-select" id="dateSelect">
                            <option value="">Most Recent</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Confidence Threshold</label>
                        <input type="range" class="form-input" id="confidenceSlider" min="0.1" max="0.9" step="0.05" value="0.25">
                        <span id="confidenceValue">0.25</span>
                    </div>
                </div>
                
                <!-- Area Information -->
                <div class="section">
                    <div class="info-card hidden" id="areaInfo">
                        <div class="area-info">
                            <div class="area-info-item">
                                <span class="area-info-label">Area</span>
                                <span class="area-info-value" id="areaAcres">-- acres</span>
                            </div>
                            <div class="area-info-item">
                                <span class="area-info-label">Est. Cost</span>
                                <span class="area-info-value cost-highlight" id="estimatedCost">$--</span>
                            </div>
                            <div class="area-info-item">
                                <span class="area-info-label">Est. Time</span>
                                <span class="area-info-value" id="estimatedTime">-- min</span>
                            </div>
                            <div class="area-info-item">
                                <span class="area-info-label">Resolution</span>
                                <span class="area-info-value">7.5 cm/px</span>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary btn-full" id="startProcessingBtn" disabled>
                        <i class="fas fa-play"></i>
                        Start Tree Detection
                    </button>
                </div>
                
                <!-- Progress Section -->
                <div class="section hidden" id="progressSection">
                    <div class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Processing Status
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">Initializing...</div>
                    </div>
                    
                    <div id="statusMessage" class="status-message status-info">
                        <i class="fas fa-info-circle"></i>
                        Ready to start processing
                    </div>
                </div>
                
                <!-- Results Section -->
                <div class="section hidden" id="resultsSection">
                    <div class="results-section">
                        <div class="results-header">
                            <h3 class="results-title">Detection Results</h3>
                        </div>
                        
                        <div class="results-stats">
                            <div class="stat-item">
                                <span class="stat-value" id="treeCount">0</span>
                                <span class="stat-label">Trees Found</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="avgConfidence">0%</span>
                                <span class="stat-label">Avg Confidence</span>
                            </div>
                        </div>
                        
                        <div class="download-section">
                            <h4 style="margin-bottom: 12px; color: #0D334C;">Download Results</h4>
                            <div class="download-grid">
                                <button class="btn btn-secondary" id="downloadCsv">
                                    <i class="fas fa-table"></i>
                                    Tree Data (CSV)
                                </button>
                                <button class="btn btn-secondary" id="downloadKml">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Boundary (KML)
                                </button>
                                <button class="btn btn-secondary" id="downloadImage">
                                    <i class="fas fa-image"></i>
                                    Detection Image
                                </button>
                                <button class="btn btn-secondary" id="downloadOriginal">
                                    <i class="fas fa-camera"></i>
                                    Original Image
                                </button>
                                <button class="btn btn-secondary" id="downloadProcessed">
                                    <i class="fas fa-crop"></i>
                                    Processed Image
                                </button>
                                <button class="btn btn-secondary" id="downloadMetadata">
                                    <i class="fas fa-info-circle"></i>
                                    Metadata
                                </button>
                                <button class="btn btn-primary" id="downloadAll">
                                    <i class="fas fa-download"></i>
                                    Download All Files
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="content-header">
                <h1 class="page-title">Tree AI</h1>
                <p class="page-subtitle">Draw a boundary on the map to analyze tree coverage</p>
            </div>
            
            <div class="map-container">
                <div id="map"></div>
                
                <!-- Map Controls -->
                <div class="map-controls">
                    <div class="map-control-card">
                        <div class="control-title">Drawing Tools</div>
                        <p style="font-size: 12px; color: #666; margin-bottom: 12px;">
                            Use the polygon tool to draw your analysis area
                        </p>
                        <button class="btn btn-primary btn-full" id="clearMapBtn">
                            <i class="fas fa-eraser"></i>
                            Clear Map
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
